define("metaphorjs-validator",["metaphorjs-observable","metaphorjs-ajax","metaphorjs-select","metaphorjs-input"],function(D,L,E,J){var F=J.getValue,M=Array.prototype.slice,N=Object.prototype.toString,G=function(){var d={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(e){if(!e){if(null===e)return 6;if(void 0===e)return 7}var g=d[N.call(e)];return void 0===g?-1:1==g&&isNaN(e)?
8:g}}(),z=function(d){return"object"==typeof d&&3===G(d)&&!d.nodeType},H=function(d){return!0===d||!1===d},l=function(){return function e(){var g=!1,f=!1,q=M.call(arguments),m=q.shift(),k,p,l;H(q[q.length-1])&&(g=q.pop());H(q[q.length-1])&&(f=g,g=q.pop());for(;q.length;)if(k=q.shift())for(p in k)if(k.hasOwnProperty(p)&&void 0!==(l=k[p]))if(f)if(m[p]&&z(m[p])&&z(l))e(m[p],l,g,f);else{if(!0===g||void 0==m[p])z(l)?(m[p]={},e(m[p],l,g,!0)):m[p]=l}else if(!0===g||void 0==m[p])m[p]=l;return m}}(),u=function(d){return"string"==
typeof d||0===G(d)},A=function(){return String.prototype.trim?function(d){return u(d)?d.trim():d}:function(d){return u(d)?d.replace(/^\s\s*/,"").replace(/\s\s*$/,""):d}}(),v=Function.prototype.bind?function(d,e){return d.bind(e)}:function(d,e){return function(){return d.apply(e,arguments)}},O=function(d,e,g){d.attachEvent?d.attachEvent("on"+e,g):d.addEventListener(e,g,!1)},P=function(d,e,g){d.detachEvent?d.detachEvent("on"+e,g):d.removeEventListener(e,g,!1)},B=function(){var d={};return function(e){return d[e]||
(d[e]=new RegExp(e))}}(),s=function(d,e){var g;if(g=e)g=!(e&&B("(?:^|\\s)"+e+"(?!\\S)").test(d.className));g&&(d.className+=" "+e)},r=function(d,e){e&&(d.className=d.className.replace(B("(?:^|\\s)"+e+"(?!\\S)"),""))},I=function(d,e,g){var f,k=d.childNodes;if(!1!==e.call(g,d))for(d=-1,f=k.length>>>0;++d!==f;I(k[d],e,g));},w=function(){return!1},x=function(){return!0},t=function(d){if(d instanceof t)return d;if(!(this instanceof t))return new t(d);for(var e in d)if(!this[e])try{this[e]=d[e]}catch(g){}this.originalEvent=
d;this.type=d.type;!this.target&&d.srcElement&&(this.target=d.srcElement);var f,k=d.button;void 0===this.pageX&&null!==d.clientX&&(f=this.target?this.target.ownerDocument||document:document,e=f.documentElement,f=f.body,this.pageX=d.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),this.pageY=d.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0));this.which||void 0===k||(this.which=k&1?1:k&2?3:k&4?2:0);this.isDefaultPrevented=d.defaultPrevented||
void 0===d.defaultPrevented&&!1===d.returnValue?x:w;this.timeStamp=d&&d.timeStamp||(new Date).getTime()};t.prototype={isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w,preventDefault:function(){var d=this.originalEvent;this.isDefaultPrevented=x;d.returnValue=!1;d&&d.preventDefault&&d.preventDefault()},stopPropagation:function(){var d=this.originalEvent;this.isPropagationStopped=x;d&&d.stopPropagation&&d.stopPropagation()},stopImmediatePropagation:function(){var d=this.originalEvent;
this.isImmediatePropagationStopped=x;d&&d.stopImmediatePropagation&&d.stopImmediatePropagation();this.stopPropagation()}};var y=function(d){return"function"==typeof d},k=function(d,e,g){return d&&d.getAttribute?void 0===g?d.getAttribute(e):null===g?d.removeAttribute(e):d.setAttribute(e,g):null},C=function(){var d=0,e={},g=function(a,b){var c=0;switch(b.nodeName.toLowerCase()){case "select":return I(b,function(a){a.selected&&c++}),c;case "input":if(/radio|checkbox/i.test(b.type))return I(b.form,function(a){a.type==
b.type&&a.name==b.name&&a.checked&&c++}),c}return a.length},f=function(a,b){if(!b)return void 0==a||""===a;switch(b.nodeName.toLowerCase()){case "select":var c=F(b);return!c||0==c.length;case "input":if(/radio|checkbox/i.test(b.type))return 0==g(a,b)}return 0==A(a).length},q=function(a,b){if(y(b))return a;if("object"!=typeof b||5!==G(b))b=[b];var c,h=b.length;for(c=-1;++c<h;a=a.replace(new RegExp("\\{"+c+"\\}","g"),b[c]));return a},m={};l(m,{required:function(a,b,c){return!1===c?!0:!f(a,b)},regexp:function(a,
b,c){c=c instanceof RegExp?c:new RegExp(c);return f(a,b)||c.test(a)},notregexp:function(a,b,c){c=c instanceof RegExp?c:new RegExp(c);return f(a,b)||!c.test(a)},minlength:function(a,b,c){return f(a,b)||(b?g(A(a),b)>=c:a.toString().length>=c)},maxlength:function(a,b,c){return f(a,b)||(b?g(A(a),b)<=c:a.toString().length<=c)},rangelength:function(a,b,c){var h=b?g(A(a),b):a.toString().length;return f(a,b)||h>=c[0]&&h<=c[1]},min:function(a,b,c){return f(a,b)||parseInt(a,10)>=c},max:function(a,b,c){return f(a,
b)||parseInt(a,10)<=c},range:function(a,b,c){a=parseInt(a,10);return f(a,b)||a>=c[0]&&a<=c[1]},email:function(a,b){return f(a,b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},
url:function(a,b){return f(a,b)||/^((https?|ftp):\/\/|)(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a,b){return f(a,b)||!/Invalid|NaN/.test(new Date(a))},dateiso:function(a,b){return f(a,b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return f(a,b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return f(a,b)||/^\d+$/.test(a)},creditcard:function(a,b){if(f(a,b))return!0;if(/[^0-9-]+/.test(a))return!1;var c=0,h=!1,d;a=a.replace(/\D/g,"");for(var e=a.length-1;0<=e;e--)d=a.charAt(e),d=parseInt(d,10),h&&9<(d*=2)&&(d-=9),c+=d,h=!h;return 0==
c%10},accept:function(a,b,c){c=u(c)?c.replace(/,/g,"|"):"png|jpe?g|gif";return f(a,b)||a.match(new RegExp(".("+c+")$","i"))},equalto:function(a,b,c,h){c=(b=h.getValidator().getField(c))?b.getElem():c;return a==F(c)},notequalto:function(a,b,c,h){c=(b=h.getValidator().getField(c))?b.getElem():c;return a!=F(c)},zxcvbn:function(a,b,c){return zxcvbn(a).score>=parseInt(c)}});var K={required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",
date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} and {1} characters long.",range:"Please enter a value between {0} and {1}.",
max:"Please enter a value less than or equal to {0}.",min:"Please enter a value greater than or equal to {0}."},p={allowSubmit:!0,alwaysCheck:!1,alwaysDisplayState:!1,data:null,ignore:null,disabled:!1,cls:{valid:"",error:"",ajax:""},errorBox:{cls:"",fn:null,tag:"",position:"after",elem:null,enabled:!0},callback:{scope:null,destroy:null,statechange:null,errorchange:null,submit:null,check:null,beforeAjax:null,afterAjax:null,displaystate:null},rules:{},messages:{}},w=function(a){if(!a)return{};var b=
function(b,h,d){var e=a[b],f=!1;if(void 0!==e){switch(d){case "string":f=u(e);break;case "function":f=y(e);break;case "boolean":f=H(e)}f&&(a[b]={},a[b][h]=e)}};b("errorBox","enabled","boolean");b("errorBox","tag","string");b("errorBox","fn","function");return a},x=function(a,b,c){b=b||{};var h,d;this._observable=new D;l(this,this._observable.getApi());this.cfg=h=l({},p,w(n.fieldDefaults),w(b),!0,!0);this.input=new J(a,this.onInputChange,this,this.onInputSubmit);this.elem=a;this.vldr=c;this.callbackScope=
d=h.callback.scope;this.enabled=!a.disabled;this.id=k(a,"name")||k(a,"id");this.data=b.data;this.rules={};h.messages=l({},K,n.messages,h.messages,!0,!0);k(a,"data-validator",c.getVldId());this.input.radio&&this.initRadio();for(var e in h.callback)if(h.callback[e])this.on(e,h.callback[e],d);h.rules&&this.setRules(h.rules,!1);this.readRules();this.prev=this.input.getValue();h.disabled&&this.disable()};x.prototype={vldr:null,elem:null,rules:null,cfg:null,callbackScope:null,input:null,enabled:!0,valid:null,
dirty:!1,id:null,prev:"",error:null,errorRule:null,pending:null,rulesNum:0,displayState:!1,data:null,checking:!1,checkTmt:null,errorBox:null,customError:!1,getValidator:function(){return this.vldr},initRadio:function(){var a=this.input.radio,b=this.vldr.getVldId(),c,h;c=0;for(h=a.length;c<h;c++)k(a[c],"data-validator",b)},setRules:function(a,b){b=void 0==b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check(!1):this.setValidState(null);return this},setRule:function(a,b,c){var h=this.rules;c=
void 0==c?!0:c;null===b?(h[a]&&this.rulesNum--,delete h[a]):(h[a]||this.rulesNum++,h[a]=b,null!==this.valid&&this.setValidState(!1));c?this.check(!1):this.setValidState(null);return this},setMessage:function(a,b){this.cfg.messages[a]=b;return this},setMessages:function(a){for(var b in a)this.setMessage(b,a[b]);return this},getMessages:function(){return l({},this.cfg.messages)},readRules:function(){var a=this.elem,b=a.className,c={},h,d;for(d in m)m.hasOwnProperty(d)&&(h=k(a,d)||k(a,"data-validate-"+
d),void 0!=h&&!1!==h&&("minlength"!=d&&"maxlength"!=d||-1!=parseInt(h,10))&&(c[d]=h,(h=k(a,"data-message-"+d))&&this.setMessage(d,h)));if(h=k(a,"remote"))c.remote=h;if(b)for(b=b.split(" "),d=0,h=b.length;d<h;d++)if(a=A(b[d]),m[a]||"remote"==a)c[a]=!0;for(d in c)this.setRule(d,c[d],!1)},getRules:function(){return this.rules},hasRule:function(a){return this.rules[a]?!0:!1},getValue:function(){return this.input.getValue()},getUserData:function(){return this.data},setUserData:function(a){var b=this.data;
this.data=a;return b},isEmpty:function(){return f(this.getValue(),this.elem)},enable:function(){this.enabled=!0;this.vldr.reset();return this},disable:function(){this.enabled=!1;!1===this.valid&&(this.setValidState(!0),this.doDisplayState());return this},enableDisplayState:function(){this.displayState=!0},disableDisplayState:function(){this.displayState=!1},isDisplayStateEnabled:function(){return this.displayState},toggleErrorBox:function(a){var b=this.cfg,c=b.errorBox.enabled;b.errorBox.enabled=
a;!c&&a&&a.displayState&&!1===this.valid()&&this.doDisplayState()},isEnabled:function(){return this.enabled},getElem:function(){return this.elem},getName:function(){return this.id},getError:function(){return this.error},getErrorRule:function(){return this.errorRule},isValid:function(){return this.isEnabled()?this.customError?!1:!0===this.valid&&!this.pending||0===this.rulesNum:!0},getExactValidState:function(){return this.valid},setCustomError:function(a,b){this.customError=a?!0:!1;this.setValidState(a?
!1:!0);this.setError(!0===a?null:a,b);this.doDisplayState()},reset:function(){this.abort();this.dirty=!1;this.prev="";this.setValidState(null);this.setError(null);this.doDisplayState();return this},abort:function(){this.pending&&(this.pending.abort(),this.pending=null);return this},check:function(a){var b=this.rules,c=this.cfg,d=this.elem;if(!this.isEnabled())return!0;if(this.customError)return!1;if(0==this.rulesNum&&!1!==this.valid)return!0;if(this.checking)return this.checkTmt||(this.checkTmt=setTimeout(v(this.checkTimeout,
this),100)),!0===this.valid;this.checking=!0;if(!(!0===a||b.equalTo||b.notEqualTo||this.dirty||null===this.valid||c.alwaysCheck))return this.pending||this.doDisplayState(),this.checking=!1,!0===this.valid;var e=!0,f=!1,g=this.getValue(),k,l;for(l in b)if("remote"==l){if(this.dirty||c.alwaysCheck||null===this.valid||!0===a)if(g||b[l].checkEmpty)f=!0}else if(!0!==(k=(y(b[l])?b[l]:m[l]).call(this.callbackScope,g,d,b[l],this))){e=!1;this.setError(q(k||c.messages[l]||"",b[l]),l);break}f=f&&e;e&&this.setError(null);
f?this.ajaxCheck():(this.setValidState(e),this.doDisplayState());this.checking=this.dirty=!1;this.trigger("check",this,this.valid);return!0===this.valid&&!f},doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,d=a.cls.valid,e=this.elem;this.displayState||a.alwaysDisplayState||(b=null);null===this.valid&&(b=null);c&&(!1===b?s(e,c):r(e,c));d&&(!0===b?s(e,d):r(e,d));c=this.getErrorBox();d=this.error;c&&(!1===b&&d&&(c.innerHTML=state.error),c.style.display=!1===b&&d&&a.errorBox.enabled?
"block":"none");this.trigger("displaystate",this,b,this.error)},getErrorBox:function(){var a=this.cfg.errorBox;return a.tag||a.fn||a.selector?(!this.errorBox&&a.enabled&&this.createErrorBox(),this.errorBox):null},destroy:function(){this.trigger("destroy",this);k(this.elem,"data-validator",null);this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);this.input.destroy();delete this.input;this._observable.destroy();delete this._observable;delete this.vldr;delete this.cfg;delete this.errorBox;
delete this.rules;delete this.elem},isPending:function(){return null!==this.pending},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},setError:function(a,b){if(this.error!=a||this.errorRule!=b)this.error=a,this.errorRule=b,this.trigger("errorchange",this,a,b)},checkTimeout:function(){this.checkTmt=null;this.checking||this.check(!1)},onInputChange:function(a){this.prev!==a&&(this.dirty=!0,this.customError=!1,this.abort(),this.pending||this.check(!1),this.prev=
this.input.getValue())},onInputSubmit:function(a){a=new t(a);if(!(a.isDefaultPrevented&&a.isDefaultPrevented()||!1!==this.trigger("submit",this,a)))return a.preventDefault(),!1},createErrorBox:function(){var a=this.cfg.errorBox,b=a.tag,c=a.cls,d=a.fn,e=a.position,a=a.elem;d?this.errorBox=d.call(this.callbackScope,this):a?this.errorBox=a:(this.errorBox=document.createElement(b),this.errorBox.className=c,b=(b=this.input.radio)?b[b-1]:this.elem,"appendParent"==e?b.parentNode.appendChild(this.errorBox):
"before"==e?b.parentNode.insertBefore(this.errorBox,b):b.parentNode.insertBefore(this.errorBox,b.nextSibling))},ajaxCheck:function(){var a=this.elem,b=this.rules.remote,c=this.getValue(),d=this.cfg,b=l({},u(b)?{url:b}:b,!0);b.data=b.data||{};b.data[b.paramName||k(a,"name")||k(a,"id")]=c;b.handler||(b.dataType="text");b.cache=!1;d.cls.ajax&&s(a,d.cls.ajax);this.trigger("beforeAjax",this,b);this.pending=L(b);this.pending.done(v(this.onAjaxSuccess,this));this.pending.fail(v(this.onAjaxError,this))},
onAjaxSuccess:function(a){var b=this.rules,c=this.cfg;this.pending=null;var d=!0;b.remote.handler?(a=b.remote.handler.call(this.callbackScope,this,a),!0!==a&&(this.setError(q(a||c.messages.remote||"",b.remote),"remote"),d=!1)):a?(this.setError(a,"remote"),d=!1):this.setError(null);c.cls.ajax&&r(this.elem,c.cls.ajax);this.setValidState(d);this.doDisplayState();this.trigger("afterAjax",this)},onAjaxError:function(a,b){var c=this.cfg;c.cls.ajax&&r(this.elem,c.cls.ajax);this.pending=null;"abort"!=b&&
"abort"!=a&&(this.setValidState(!1),this.doDisplayState(),this.trigger("afterAjax",this))}};var z={alwaysCheck:!1,alwaysDisplayState:!1,disabled:!1,value:null,elem:null,errorBox:null,errorField:null,data:null,cls:{valid:"",error:""},fields:[],rules:{},messages:{},callback:{scope:null,destroy:null,statechange:null,errorchange:null,displaystate:null}},B=function(a,b){a=a||{};var c,d;this._observable=new D;this._vldr=b;l(this,this._observable.getApi());this.cfg=c=l({},z,n.groupDefaults,a,!0,!0);this.callbackScope=
d=c.callback.scope;this.data=a.data;this.el=a.elem;this.fields={};this.rules={};c.messages=l({},K,n.messages,c.messages,!0,!0);var e;if(c.callback)for(e in c.callback)if(c.callback[e])this.on(e,c.callback[e],d);c.rules&&this.setRules(c.rules,!1);if(c.fields)for(e=0,d=a.fields.length;e<d;e++)this.add(b.getField(c.fields[e]));this.enabled=!c.disabled};B.prototype={fields:null,rules:null,cfg:null,callbackScope:null,vldr:null,enabled:!1,invalid:null,valid:null,displayState:!1,rulesNum:0,error:null,data:null,
errorBox:null,el:null,enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},isValid:function(){return!this.enabled||0===this.invalid&&!0===this.valid},getExactValidState:function(){return this.valid},reset:function(){this.invalid=0;this.setValidState(null);this.setError(null);this.doDisplayState();return this},getUserData:function(){return this.data},getName:function(){return this.cfg.name},setRules:function(a,b){b=
void 0==b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check():this.setValidState(null);return this},setRule:function(a,b,c){var d=this.rules;c=void 0==c?!0:c;null===b?(d[a]&&this.rulesNum--,delete d[a]):(d[a]||this.rulesNum++,d[a]=b,null!==this.valid&&this.setValidState(!1));c?this.check():this.setValidState(null);return this},getRules:function(){return l({},this.rules)},hasRule:function(a){return this.rules[a]?!0:!1},setError:function(a){var b=this.cfg;this.error!=a&&(b.errorField?(this.vldr.getField(b.errorField).setError(a),
this.error=null):(this.error=a,this.trigger("errorchange",this,a)))},getError:function(){return this.error},getFields:function(){return this.fields},enableDisplayState:function(){this.displayState=!0;return this},disableDisplayState:function(){this.displayState=!1;return this},check:function(){var a=this.cfg,b=this.fields,c=this.rules;if(!this.enabled||0==this.rulesNum)return this.setValidState(null),this.doDisplayState(),!0;this.countInvalid();if(0<this.invalid)return this.setValidState(null),this.doDisplayState(),
!0;var d={},e=!0,f=null,g;if(a.value){for(g in b)d[g]=b[g].getValue();f=a.value.call(this.callbackScope,d,this)}for(g in c)if(!0!==(b=(y(c[g])?c[g]:m[g]).call(this.callbackScope,f,null,c[g],this,d))){e=!1;b||a.messages[g]?this.setError(q(b||a.messages[g]||"",c[g])):this.setError(null);break}e&&this.setError(null);this.setValidState(e);this.doDisplayState();return!0===this.valid},doDisplayState:function(){var a=this.valid,b=this.cfg;this.displayState||b.alwaysDisplayState||(a=null);if(b.errorBox){var c=
this.getErrorBox();null!==a?c&&(c.innerHTML=this.error||"",c.style.display=!1===this.valid?"block":"none"):c&&(c.style.display="none")}c=b.cls.error;b=b.cls.valid;a=this.valid;c&&(!1===a?s(this.el,c):r(this.el,c));b&&(!0===a?s(this.el,b):r(this.el,b));this.trigger("displaystate",this,this.valid)},getErrorBox:function(){var a=this.cfg,b=this.fields,c=a.errorBox;if(b[c])return b[c].getErrorBox();this.errorBox||(y(a.errorBox)?this.errorBox=a.errorBox.call(this.callbackScope,this):this.errorBox=a.errorBox);
return this.errorBox},destroy:function(){var a=this.fields,b;for(b in a)a[b]&&(this.setFieldEvents(a[b],"un"),delete a[b]);this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);this._observable.destroy();delete this._observable;delete this.vldr;delete this.rules;delete this.fields;delete this.cfg},add:function(a){var b=this.fields,c=a.getName();b[c]||(b[c]=a,this.setFieldEvents(a,"on"))},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this)},remove:function(a){var b=
this.fields,c=a.getName();b[c]&&(delete b[c],this.setFieldEvents(a,"un"));return this},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},countInvalid:function(){var a=this.fields;this.invalid=0;for(var b in a)this.invalid+=a[b].isValid()?0:1},onFieldStateChange:function(a,b){this.trigger("fieldstatechange",this,a,b);this.check()}};var C={form:null,all:{},fields:{},rules:{},cls:{valid:"",error:"",checking:""},groups:{},callback:{scope:null,destroy:null,reset:null,
beforesubmit:null,submit:null,statechange:null,check:null,displaystate:null,displaystatechange:null}},n=function(a,b,c){var h=a.nodeName.toLowerCase();this.vldId=++d;e[this.vldId]=this;k(a,"data-validator",this.vldId);this.el=a;b&&!u(b)&&(c=b,b=null);this._observable=new D;this.cfg=a=l({},C,n.defaults,n[b],c,!0,!0);this.callbackScope=b=a.callback.scope;this.isForm="form"==h;this.isField=/input|select|textarea/.test(h);this.fields={};this.groups={};l(this,this._observable.getApi());this._observable.createEvent("submit",
!1);this._observable.createEvent("beforesubmit",!1);this.onRealSubmitClickDelegate=v(this.onRealSubmitClick,this);this.resetDelegate=v(this.reset,this);this.onSubmitClickDelegate=v(this.onSubmitClick,this);this.onFormSubmitDelegate=v(this.onFormSubmit,this);delete a.callback.scope;var f,g;for(g in a.callback)this.on(g,a.callback[g],b);this.initFields();h=this.fields;for(f in a.rules)h[f]&&h[f].setRules(a.rules[f],!1);a.rules=null;for(f in a.groups)this.addGroup(f,a.groups[f]);this.initForm("bind");
delete a.rules;delete a.fields;delete a.groups;this.enabled=!0};n.prototype={vldId:null,el:null,cfg:null,enabled:!1,invalid:null,pending:0,grps:0,outside:!0,submitted:!1,displayState:!1,isForm:!1,isField:!1,submitButton:null,hidden:null,callbackScope:null,preventFormSubmit:!1,_observable:null,fields:null,groups:null,getVldId:function(){return this.vldId},getElem:function(){return this.el},getGroup:function(a){return this.groups[a]||null},getField:function(a){return this.fields[a]||null},enable:function(){this.enabled=
!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},enableDisplayState:function(){var a=this.fields,b=this.groups,c;if(!0!==this.displayState){this.displayState=!0;for(c in a)a[c].enableDisplayState();for(c in b)b[c].enableDisplayState();this.trigger("displaystatechange",this,!0)}return this},disableDisplayState:function(){var a=this.groups,b=this.fields,c;if(!1!==this.displayState){this.displayState=!1;for(c in b)b[c].disableDisplayState();for(c in a)a[c].disableDisplayState();
this.trigger("displaystatechange",this,!1)}return this},isDisplayStateEnabled:function(){return this.displayState},isValid:function(){return!1===this.enabled?!0:0===this.invalid&&0===this.pending&&0===this.grps&&!0===this.outside},getErrors:function(a){var b=!0==a?[]:{},c,d,e,f=[this.fields,this.groups],g;if(!this.isEnabled())return b;for(e=0;2>e;e++)for(d in g=f[e],g)null===g[d].getExactValidState()&&g[d].check(),g[d].isValid()||(c=g[d].getError())&&(a?b.push(c):b[d]=c);return b},check:function(){var a=
this.fields,b=this.groups;if(!this.isEnabled())return!0;var c=this.isValid(),d;for(d in a)a[d].check();for(d in b)b[d].check();this.outside=!1!==this.trigger("check",this);a=this.isValid();c!=a&&(this.doDisplayState(),this.trigger("statechange",this,!1));return a},add:function(a,b){var c=a.nodeName.toLowerCase(),d=a.type;if("input"!=c&&"textarea"!=c&&"select"!=c||"submit"==d||"reset"==d||"button"==d||null!==k(a,"data-no-validate")||null!==k(a,"data-validator"))return this;var d=k(a,"name")||k(a,"id"),
e=this.cfg,c=this.fields;if(!d)return this;d=e.fields&&e.fields[d]?e.fields[d]:b||{};u(d)&&(d={rules:[d]});d=l({},e.all||{},d,!0,!0);if(d.ignore)return this;d.callback||(d.callback={scope:this.callbackScope});e=new x(a,d,this);d=e.getName();if(c[d])return this;c[d]=e;this.setFieldEvents(e,"on");this.displayState&&e.enableDisplayState();this.isEnabled()&&null!==this.invalid&&e.check();return this},addGroup:function(a,b){var c=this.groups;c[a]||(b.name=a,c[a]=new B(b,this),this.setGroupEvents(c[a],
"on"),this.isEnabled()&&null!==this.invalid&&c[a].check())},focusInvalid:function(){var a=this.fields,b;for(b in a)if(!a[b].isValid()){a[b].getElem().focus();break}},reset:function(){var a=this.fields,b=this.groups,c;this.submitted=!1;this.disableDisplayState();for(c in b)b[c].reset();for(c in a)a[c].reset();this.pending=0;this.invalid=null;this.grps=0;this.outside=!1;this.doDisplayState();this.trigger("reset",this);return this},submit:function(){var a=this.el;if(this.isForm)if(y(a.submit))!1!==this.trigger("beforesubmit",
this)&&!1!==this.trigger("submit",this)&&a.submit();else this.onSubmit();else this.onSubmit()},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this);a[b]("beforeAjax",this.onBeforeAjax,this);a[b]("afterAjax",this.onAfterAjax,this);a[b]("submit",this.onFieldSubmit,this);a[b]("destroy",this.onFieldDestroy,this)},setGroupEvents:function(a,b){a[b]("statechange",this.onGroupStateChange,this)},initFields:function(){var a=this.el,b,c;if(this.isField)return this.add(a),this;a=E("input, textarea, select",
a);b=-1;for(c=a.length;++b<c;this.add(a[b]));return this},initForm:function(a){var b=this.el,c=b.getElementsByTagName("input"),d=E(".submit",b),e=E(".reset",b);a="bind"==a?O:P;var f,g,k,l;f=0;for(g=c.length;f<g;f++)l=c[f],k=l.type,"submit"==k?a(l,"click",this.onRealSubmitClickDelegate):"reset"==k&&a(l,"click",this.resetDelegate);f=-1;for(g=d.length;++f<g;"submit"!=d[f].type&&a(d[f],"click",this.onSubmitClickDelegate));f=-1;for(g=e.length;++f<g;"reset"!=e[f].type&&a(e[f],"click",this.resetDelegate));
this.isForm&&a(b,"submit",this.onFormSubmitDelegate)},onRealSubmitClick:function(a){a=new t(a||window.event);this.submitButton=a.target||a.srcElement;this.preventFormSubmit=!1;return this.onSubmit(a)},onSubmitClick:function(a){this.preventFormSubmit=!1;return this.onSubmit(new t(a||window.event))},onFormSubmit:function(a){a=new t(a);if(!this.isValid()||this.preventFormSubmit)return a.preventDefault(),!1},onFieldSubmit:function(a,b){this.preventFormSubmit=!1;this.enableDisplayState();this.submitted=
!0;return this.onSubmit(b)},onSubmit:function(a){this.enableDisplayState();if(this.pending)return a&&a.preventDefault(),!1;var b=this.submitButton?!0:!1;this.isForm&&(this.hidden&&(this.el.removeChild(this.hidden),this.hidden=null),this.submitButton&&/input|button/.test(this.submitButton.nodeName)&&(this.hidden=document.createElement("input"),this.hidden.type="hidden",k(this.hidden,"name",this.submitButton.name),this.hidden.value=this.submitButton.value,this.el.appendChild(this.hidden)));this.submitButton=
null;if(!this.isValid()&&(this.check(),this.onFieldStateChange(),this.pending))return a&&a.preventDefault(),!1;if(!1===this.trigger("beforesubmit",this)||!this.isValid())return a&&(a.preventDefault(),a.stopPropagation()),this.pending||(this.focusInvalid(),this.submitted=!1),this.trigger("failedsubmit",this,b),!1;this.pending||(this.submitted=!1);a=this.trigger("submit",this);this.preventFormSubmit=!a;return a},onFieldDestroy:function(a){a=a.getElem();a=k(a,"name")||k(a,"id");delete this.fields[a]},
onFieldStateChange:function(a,b){var c=this.invalid,d=this.fields;this.invalid=0;for(var e in d)this.invalid+=d[e].isValid()?0:1;a&&this.trigger("fieldstatechange",this,a,b);if(null===c||null!==c&&this.invalid!==c)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},onGroupStateChange:function(){var a=this.groups,b=this.grps;this.grps=0;for(var c in a)this.grps+=a[c].isValid()?0:1;if(null===b||null!==b&&this.grps!==b)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},
doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,a=a.cls.valid,d=this.el;if(this.isField||!this.displayState)b=null;null===this.invalid&&(b=null);c&&(!1===b?s(d,c):r(d,c));a&&(!0===b?s(d,a):r(d,a));this.trigger("displaystate",this,b)},onBeforeAjax:function(){this.pending++;this.cfg.cls.ajax&&s(this.el,this.cfg.cls.ajax)},onAfterAjax:function(){var a=this.fields,b=this.cfg;this.pending=0;for(var c in a)this.pending+=a[c].isPending()?1:0;this.doDisplayState();b.cls.ajax&&r(this.el,
b.cls.ajax);this.submitted&&0==this.pending&&(this.submitted=!1,this.isValid()?this.submit():this.focusInvalid())},destroy:function(){var a=this.groups,b=this.fields,c;this.reset();this.trigger("destroy",this);delete e[this.vldId];for(c in a)a.hasOwnProperty(c)&&a[c]&&(this.setGroupEvents(a[c],"un"),a[c].destroy(),delete a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&(this.setFieldEvents(b[c],"un"),b[c].destroy(),delete b[c]);this._observable.destroy();delete this._observable;this.initForm("unbind");
delete this.fields;delete this.groups;delete this.el;delete this.cfg}};n.defaults={};n.messages={};n.fieldDefaults={};n.groupDefaults={};n.addMethod=function(a,b,c){m[a]||(m[a]=b,c&&(n.messages[a]=c))};n.getValidator=function(a){a=k(a,"data-validator");return e[a]||null};return n}();window.jQuery&&(jQuery.fn.metaphorjsValidator=function(d,e,g){var f="metaphorjsValidator",k;"string"==typeof d&&"destroy"!=d&&(k=d,d=e,e=g);e=e||"default";d=d||{};f+="-"+e;this.each(function(){var g=$(this),l=g.data(f);
if("destroy"==d)l&&(l.destroy(),g.data(f,null));else{if(l)throw Error("MetaphorJs validator is already instantiated for this html element");d.form=g;d.instanceName=e;g.data(f,new C(k,d))}})});return C});
