(function(){var M={lib:{}},$=function(h){return null===h},x=function(h){return"undefined"==typeof h},N=function(h){return"string"==typeof h},R=function(){var h=/\r/,a={option:function(a){var c=a.getAttribute("value")||a.value;return null===c||x(c)?O(a.innerText||a.textContent):c},select:function(a){for(var c,d=a.options,g=a.selectedIndex,t=(a="select-one"===a.type||0>g)?null:[],k=a?g+1:d.length,A,h=0>g?k:a?g:0;h<k;h++)if(c=d[h],A=c.disabled||c.parentNode.disabled,(c.selected||h===g)&&!A){c=R(c);if(a)return c;
t.push(c)}return t},radio:function(a){return $(a.getAttribute("value"))?"on":a.value},checkbox:function(a){return $(a.getAttribute("value"))?"on":a.value}};return function(b){var c,d;if((c=a[b.type]||a[b.nodeName.toLowerCase()])&&!x(d=c(b,"value")))return d;d=b.value;return N(d)?d.replace(h,""):null==d?"":d}}(),J=Array.prototype.slice,aa=function(h){return!(!h||h.constructor!==Object)},h=function a(){var b=!1,c=!1,d=J.call(arguments),g=d.shift(),t,k,h;"boolean"==typeof d[d.length-1]&&(b=d.pop());
"boolean"==typeof d[d.length-1]&&(c=b,b=d.pop());for(;d.length;)if(t=d.shift())for(k in t)if(t.hasOwnProperty(k)&&!x(h=t[k]))if(c)if(g[k]&&aa(g[k])&&aa(h))a(g[k],h,b,c);else{if(!0===b||x(g[k])||null===g[k])aa(h)?(g[k]={},a(g[k],h,b,!0)):g[k]=h}else if(!0===b||x(g[k])||null===g[k])g[k]=h;return g},la=Object.prototype.toString,ha=function(a){return"number"==typeof a&&!isNaN(a)},ia=function(a){return!(!a||null==a||"object"!==typeof a||!ha(a.length)||"[object Array]"!=la.call(a))},O=function(){return String.prototype.trim?
function(a){return N(a)?a.trim():a}:function(a){return N(a)?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),D=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},E=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},ba=function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},ja=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),K=function(a,b){var c;
if(c=b)c=!(b&&ja("(?:^|\\s)"+b+"(?!\\S)").test(a.className));c&&(a.className+=" "+b)},F=function(a,b){b&&(a.className=a.className.replace(ja("(?:^|\\s)"+b+"(?!\\S)"),""))},W=function(a){if(!a||x(a.length)||N(a))return a?[a]:[];for(var b=[],c=-1,d=a.length>>>0;++c!==d;b[c]=a[c]);return b},ca=function(){var a=/^[\w[:#.][\w\]*^|=!]*$/,b=/=([^\]]+)/,c=/ *, */,d=/(\([^)]*)\+/,g=/(\[[^\]]+)~/,t=/(~|>|\+)/,k=/ +/,h=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
B=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,ma=/\D/,x=/[^(]*\(([^)]*)\)/,D=/\(.*/,E=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,n=document,e=!!n.getElementsByClassName,m=!!n.querySelectorAll,f={"first-child":function(e){return e.parentNode.getElementsByTagName("*")[0]!==e},"last-child":function(e){for(;(e=e.nextSibling)&&1!=e.nodeType;);return!!e},root:function(e){return"html"!==e.nodeName.toLowerCase()},"nth-child":function(e,a){var m=e.nodeIndex||0,f=a[3]=a[3]?("%"===a[2]?-1:1)*a[3]:0,b=a[1];if(m)return!((m+
f)%b);var c=e.parentNode.firstChild;m++;do if(1==c.nodeType&&(c.nodeIndex=++m)&&e===c&&(m+f)%b)return 0;while(c=c.nextSibling);return 1},"nth-last-child":function(e,a){var m=e.nodeIndexLast||0,f=a[3]?("%"===a[2]?-1:1)*a[3]:0,b=a[1];if(m)return!((m+f)%b);var c=e.parentNode.lastChild;m++;do if(1==c.nodeType&&(c.nodeLastIndex=m++)&&e===c&&(m+f)%b)return 0;while(c=c.previousSibling);return 1},empty:function(e){return!!e.firstChild},parent:function(e){return!e.firstChild},"only-child":function(e){return 1!=
e.parentNode.getElementsByTagName("*").length},checked:function(e){return!e.checked},lang:function(e,a){return e.lang!==a&&n.documentElement.lang!==a},enabled:function(e){return e.disabled||"hidden"===e.type},disabled:function(e){return!e.disabled},selected:function(e){return!e.selected}},C={},G=function(e){return C[e]||(C[e]=new RegExp("(^| +)"+e+"($| +)"))},z={"":function(e,a){return!!e.getAttribute(a)},"=":function(e,a,m){return(a=e.getAttribute(a))&&a===m},"&=":function(e,a,m){return(a=e.getAttribute(a))&&
G(m).test(a)},"^=":function(e,a,m){return(a=e.getAttribute(a)+"")&&!a.indexOf(m)},"$=":function(e,a,m){return(a=e.getAttribute(a)+"")&&a.indexOf(m)==a.length-m.length},"*=":function(e,a,m){return(a=e.getAttribute(a)+"")&&-1!=a.indexOf(m)},"|=":function(e,a,m){return(a=e.getAttribute(a)+"")&&(a===m||!!a.indexOf(m+"-"))},"!=":function(e,a,m){return!(a=e.getAttribute(a))||!G(m).test(a)}};return function(C,G){G=G||n;var l=[],s=null,u,y,L,p,P,v,w;if(m)try{l=W(G.querySelectorAll(C.replace(b,'="$1"')))}catch(N){s=
!0}if(!m||s)if(a.test(C))switch(s=0,C.charAt(0)){case "#":s=C.slice(1);l=n.getElementById(s);l.id!==s&&(l=n.all[s]);l=l?[l]:[];break;case ".":u=C.slice(1);if(e)l=W((l=G.getElementsByClassName(u)).length?l:[]);else{u=" "+u+" ";y=G.getElementsByTagName("*");for(L=0;p=y[L++];)-1!=(" "+p.className+" ").indexOf(u)&&(l[s++]=p);l=s?l:[]}break;case ":":y=G.getElementsByTagName("*");L=0;P=C.replace(x,"$1");for(v=C.replace(D,"");p=y[L++];)f[v]&&!f[v](p,P)&&(l[s++]=p);l=s?l:[];break;case "[":y=G.getElementsByTagName("*");
L=0;p=E.exec(C);u=p[1];w=p[2]||"";for(P=p[3];p=y[L++];)z[w]&&(z[w](p,u,P)||"class"===u&&z[w](p,"className",P))&&(l[s++]=p);l=s?l:[];break;default:l=W((l=G.getElementsByTagName(C)).length?l:[])}else{for(var F=C.split(c),H=F.length-1,M=!!H,K,Q,r,O,S,T,U,V,R,q,I,J;s=F[H--];){Q=(K=s.replace(d,"$1%").replace(g,"$1&").replace(t," $1 ").split(k)).length;L=0;O=" ";for(y=[G];r=K[L++];)if(" "!==r&&">"!==r&&"~"!==r&&"+"!==r&&y){r=r.match(h);S=r[1]||"*";T=r[2];U=r[3]?" "+r[3]+" ":"";u=r[4];w=r[5]||"";v=r[7];
P="nth-child"===v||"nth-last-child"===v?B.exec("even"===r[8]&&"2n"||"odd"===r[8]&&"2n%1"||!ma.test(r[8])&&"0n%"+r[8]||r[8]):r[8];V=[];s=R=0;for(I=L==Q;q=y[R++];)switch(O){case " ":J=q.getElementsByTagName(S);for(q=0;p=J[q++];)T&&p.id!==T||U&&-1==(" "+p.className+" ").indexOf(U)||!(!u||z[w]&&(z[w](p,u,r[6])||"class"===u&&z[w](p,"className",r[6])))||p.yeasss||(f[v]?f[v](p,P):v)||(I&&(p.yeasss=1),V[s++]=p);break;case "~":for(S=S.toLowerCase();(q=q.nextSibling)&&!q.yeasss;)1!=q.nodeType||"*"!==S&&q.nodeName.toLowerCase()!==
S||T&&q.id!==T||U&&-1==(" "+q.className+" ").indexOf(U)||!(!u||z[w]&&(z[w](p,u,r[6])||"class"===u&&z[w](p,"className",r[6])))||q.yeasss||(f[v]?f[v](q,P):v)||(I&&(q.yeasss=1),V[s++]=q);break;case "+":for(;(q=q.nextSibling)&&1!=q.nodeType;);!q||q.nodeName.toLowerCase()!==S.toLowerCase()&&"*"!==S||T&&q.id!==T||U&&-1==(" "+p.className+" ").indexOf(U)||!(!u||z[w]&&(z[w](p,u,r[6])||"class"===u&&z[w](p,"className",r[6])))||q.yeasss||(f[v]?f[v](q,P):v)||(I&&(q.yeasss=1),V[s++]=q);break;case ">":for(J=q.getElementsByTagName(S),
L=0;p=J[L++];)p.parentNode!==q||T&&p.id!==T||U&&-1==(" "+p.className+" ").indexOf(U)||!(!u||z[w]&&(z[w](p,u,r[6])||"class"===u&&z[w](p,"className",r[6])))||p.yeasss||(f[v]?f[v](p,P):v)||(I&&(p.yeasss=1),V[s++]=p)}y=V}else O=r;if(M){if(!y.concat){V=[];for(q=0;p=y[q];)V[q++]=p;y=V}l=y.concat(1==l.length?l[0]:l)}else l=y}for(s=l.length;s--;)l[s].yeasss=l[s].nodeIndex=l[s].nodeIndexLast=null}return l}}(),da=function(a,b,c){var d,g=a.childNodes;if(!1!==b.call(c,a))for(a=-1,d=g.length>>>0;++a!==d;da(g[a],
b,c));},X=function(){return!1},Y=function(){return!0},H=function(a){if(a instanceof H)return a;if(!(this instanceof H))return new H(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(c){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var d,g=a.button;x(this.pageX)&&null!==a.clientX&&(d=this.target?this.target.ownerDocument||document:document,b=d.documentElement,d=d.body,this.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&
d.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0));this.which||void 0===g||(this.which=g&1?1:g&2?3:g&4?2:0);this.isDefaultPrevented=a.defaultPrevented||x(a.defaultPrevented)&&!1===a.returnValue?Y:X;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};H.prototype={isDefaultPrevented:X,isPropagationStopped:X,isImmediatePropagationStopped:X,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Y;a.returnValue=!1;a&&a.preventDefault&&
a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Y;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Y;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}};M.lib.NormalizedEvent=H;var Z=Array.prototype.indexOf;Z||(Z=Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=
Object(this),g=d.length>>>0;if(0===g)return-1;c=+b||0;Infinity===Math.abs(c)&&(c=0);if(c>=g)return-1;for(c=Math.max(0<=c?c:g-Math.abs(c),0);c<g;){if(c in d&&d[c]===a)return c;c++}return-1});var na=function(){var a={select:function(a,c){for(var d,g,t=a.options,k=W(c),h=t.length,B=-1;h--;)g=t[h],(g.selected=k?-1!=Z.call(k,g.value):!1)?d=!0:$(g.getAttribute("mjs-default-option"))||(B=h);d||(a.selectedIndex=B);return k}};a.radio=a.checkbox=function(a,c){if(ia(c)){var d;d=R(a);d=c?-1!=Z.call(c,d):!1;return a.checked=
d}};return function(b,c){if(1===b.nodeType){null===c?c="":ha(c)&&(c+="");var d=a[b.type]||a[b.nodeName.toLowerCase()];if(!d||x(d(b,c,"value")))b.value=c}}}(),ea=navigator.userAgent.toLowerCase(),oa=function(){var a=parseInt((/android (\d+)/.exec(ea)||[])[1],10)||!1;return function(){return a}}(),pa=function(){var a=parseInt((/msie (\d+)/.exec(ea)||[])[1],10);isNaN(a)&&(a=parseInt((/trident\/.*; rv:(\d+)/.exec(ea)||[])[1],10)||!1);return function(){return a}}(),ka=function(){var a={};return function(b){if(void 0===
a[b]){if("input"==b&&9==pa())return a[b]=!1;var c=document.createElement("div");a[b]=!!("on"+b in c)}return a[b]}}(),fa=function(a,b,c,d){this.el=a;this.cb=b;this.scb=d;this.cbContext=c;this.inputType=b=a.getAttribute("mjs-input-type")||a.type.toLowerCase();this.listeners=[];c=a.type?a.type.toLowerCase():"";this.submittable="input"==a.nodeName.toLowerCase()&&"radio"!=c&&"checkbox"!=c;"radio"==b?this.initRadioInput():"checkbox"==b?this.initCheckboxInput():this.initTextInput()};fa.prototype={el:null,
inputType:null,cb:null,scb:null,cbContext:null,listeners:[],radio:null,submittable:!1,destroy:function(){var a=this.inputType,b=this.listeners,c=this.radio,d=this.el,g,t,k,h;g=0;for(t=b.length;g<t;g++)if("radio"==a)for(k=0,h=c.length;k<h;k++)ba(c[k],b[g][0],b[g][1]);else ba(d,b[g][0],b[g][1]);delete this.radio;delete this.el;delete this.cb;delete this.cbContext},initRadioInput:function(){var a=this.el,b=a.type,a=a.name,c,d,g;this.onRadioInputChangeDelegate=D(this.onRadioInputChange,this);if(document.querySelectorAll)c=
document.querySelectorAll("input[name="+a+"]");else{var h=document.getElementsByTagName("input"),k;c=[];d=0;for(g=h.length;d<g;d++)k=h[d],k.type==b&&k.name==a&&c.push(k)}this.radio=c;this.listeners.push(["click",this.onRadioInputChangeDelegate]);d=0;for(g=c.length;d<g;d++)E(c[d],"click",this.onRadioInputChangeDelegate)},initCheckboxInput:function(){this.onCheckboxInputChangeDelegate=D(this.onCheckboxInputChange,this);this.listeners.push(["click",this.onCheckboxInputChangeDelegate]);E(this.el,"click",
this.onCheckboxInputChangeDelegate)},initTextInput:function(){var a=!1,b=this,c=b.el,d=b.listeners,g;if(!oa()){var h=function(){a=!0},k=function(){a=!1;A()};d.push(["compositionstart",h]);d.push(["compositionend",k]);E(c,"compositionstart",h);E(c,"compositionend",k)}var A=b.onTextInputChangeDelegate=function(){if(!a)b.onTextInputChange()};if(ka("input"))d.push(["input",A]),E(c,"input",A);else{var B=function(a){g||(g=window.setTimeout(function(){A(a);g=null},0))},h=function(a){a=a||window.event;var c=
a.keyCode;if(13==c&&b.submittable&&b.scb)return b.scb.call(b.cbContext,a);91===c||15<c&&19>c||37<=c&&40>=c||B(a)};d.push(["keydown",h]);E(c,"keydown",h);ka("paste")&&(d.push(["paste",B]),d.push(["cut",B]),E(c,"paste",B),E(c,"cut",B))}d.push(["change",A]);E(c,"change",A)},processValue:function(a){switch(this.inputType){case "number":a=parseInt(a,10),isNaN(a)&&(a=0)}return a},onTextInputChange:function(){var a=this.getValue();this.cb.call(this.cbContext,a)},onCheckboxInputChange:function(){var a=this.el;
this.cb.call(this.cbContext,a.checked?a.getAttribute("value")||!0:!1)},onRadioInputChange:function(a){a=a||window.event;this.cb.call(this.cbContext,(a.target||a.srcElement).value)},setValue:function(a){var b=this.inputType,c,d;if("radio"==b)for(b=this.radio,c=0,d=b.length;c<d;c++){if(b[c].value==a){b[c].checked=!0;break}}else"checkbox"==b?(b=this.el,b.checked=!0===a||a==b.value):na(this.el,a)},getValue:function(){var a=this.inputType,b,c;if("radio"==a){a=this.radio;b=0;for(c=a.length;b<c;b++)if(a[b].checked)return a[b].value;
return null}return"checkbox"==a?this.el.checked?this.el.getAttribute("value")||!0:!1:this.processValue(R(this.el))}};M.lib.Input=fa;var qa=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),Q=function(a){return"function"===typeof a},I=function(){this.events={}};I.prototype={createEvent:function(a,b){a=a.toLowerCase();
var c=this.events;c[a]||(c[a]=new ga(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();var g=this.events;g[a]||(g[a]=new ga(a));return g[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();var d=this.events;return d[a]?d[a].hasListener(b,c):!1},removeAllListeners:function(a){var b=
this.events;b[a]&&b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,J.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},
destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},destroy:function(a){var b=this.events;if(a)a=a.toLowerCase(),b[a]&&(b[a].destroy(),delete b[a]);else{for(var c in b)b[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,d=-1,g=a.length;++d<g;c=a[d],b[c]=D(this[c],
this));this.api=b}return this.api}};var ga=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=qa();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=x(b)?null:b};ga.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,g=b||a;if(g[d]&&!c.allowDupes)return null;var h=++this.lid,k=c.first||!1;g[d]=h;a={fn:a,scope:b,uniScope:g,id:h,called:0,limit:c.limit||
0,start:c.start||1,count:0,append:c.append,prepend:c.prepend};k?this.listeners.unshift(a):this.listeners.push(a);this.map[h]=a;return h},once:function(a,b,c){c=c||{};c.once=!0;return this.on(a,b,c)},un:function(a,b){var c=-1,d=this.uni,g=this.listeners,h;h=a==parseInt(a)?a:(b||a)[d];if(!h)return!1;for(var k=0,A=g.length;k<A;k++)if(g[k].id==h){c=k;delete g[k].uniScope[d];break}if(-1==c)return!1;g.splice(c,1);delete this.map[h];return!0},hasListener:function(a,b){var c=this.listeners,d;if(a){b=b||a;
d=Q(a)?b[this.uni]:a;if(!d)return!1;for(var g=0,h=c.length;g<h;g++)if(c[g].id==d)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c,d;c=0;for(d=a.length;c<d;c++)delete a[c].uniScope[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var c;a.append||a.prepend?(c=J.call(b),a.prepend&&(c=a.prepend.concat(c)),a.append&&(c=c.concat(a.append))):c=b;return c},trigger:function(){var a=
this.listeners,b=this.returnResult;if(this.suspended||0==a.length)return null;for(var c="all"==b?[]:null,d,g,a="first"==b?[a[0]]:J.call(a);d=a.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){g=d.fn.apply(d.scope,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==b&&c.push(g);if("first"==b)return g;"last"==b&&(c=g);if(!1==b&&!1===g)break}if(b)return c}};(function(){var a=new I;h(M,a.getApi(),!0,!1)})();M.lib.Observable=I;var ra=function(){var a=0,b={},
c=function(e,a){var f=0;switch(a.nodeName.toLowerCase()){case "select":return da(a,function(e){e.selected&&f++}),f;case "input":if(/radio|checkbox/i.test(a.type))return da(a.form,function(e){e.type==a.type&&e.name==a.name&&e.checked&&f++}),f}return e.length},d=function(e,a){if(!a)return void 0===e||""===e||null===e;switch(a.nodeName.toLowerCase()){case "select":var f=R(a);return!f||0==f.length;case "input":if(/radio|checkbox/i.test(a.type))return 0==c(e,a)}return 0==O(e).length},g=function(e,a){if(Q(a))return e;
ia(a)||(a=[a]);var f,b=a.length;for(f=-1;++f<b;e=e.replace(new RegExp("\\{"+f+"\\}","g"),a[f]));return e},t={};h(t,{required:function(e,a,f){return!1===f?!0:!d(e,a)},regexp:function(e,a,f){f=f instanceof RegExp?f:new RegExp(f);return d(e,a)||f.test(e)},notregexp:function(e,a,f){f=f instanceof RegExp?f:new RegExp(f);return d(e,a)||!f.test(e)},minlength:function(e,a,f){return d(e,a)||(a?c(O(e),a)>=f:e.toString().length>=f)},maxlength:function(e,a,f){return d(e,a)||(a?c(O(e),a)<=f:e.toString().length<=
f)},rangelength:function(e,a,f){var b=a?c(O(e),a):e.toString().length;return d(e,a)||b>=f[0]&&b<=f[1]},min:function(e,a,f){return d(e,a)||parseInt(e,10)>=f},max:function(e,a,f){return d(e,a)||parseInt(e,10)<=f},range:function(e,a,f){e=parseInt(e,10);return d(e,a)||e>=f[0]&&e<=f[1]},email:function(e,a){return d(e,a)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e)},
url:function(e,a){return d(e,a)||/^((https?|ftp):\/\/|)(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},
date:function(e,a){return d(e,a)||!/Invalid|NaN/.test(new Date(e))},dateiso:function(e,a){return d(e,a)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(e)},number:function(e,a){return d(e,a)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(e)},digits:function(e,a){return d(e,a)||/^\d+$/.test(e)},creditcard:function(e,a){if(d(e,a))return!0;if(/[^0-9-]+/.test(e))return!1;var f=0,b=!1,c;e=e.replace(/\D/g,"");for(var g=e.length-1;0<=g;g--)c=e.charAt(g),c=parseInt(c,10),b&&9<(c*=2)&&(c-=9),f+=c,b=!b;return 0==
f%10},accept:function(e,a,f){f=N(f)?f.replace(/,/g,"|"):"png|jpe?g|gif";return d(e,a)||e.match(new RegExp(".("+f+")$","i"))},equalto:function(e,a,f,b){f=(a=b.getValidator().getField(f))?a.getElem():f;return e==R(f)},notequalto:function(e,a,f,b){f=(a=b.getValidator().getField(f))?a.getElem():f;return e!=R(f)},zxcvbn:function(e,a,f){return zxcvbn(e).score>=parseInt(f)}});var k={required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",
date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} and {1} characters long.",range:"Please enter a value between {0} and {1}.",
max:"Please enter a value less than or equal to {0}.",min:"Please enter a value greater than or equal to {0}."},A={allowSubmit:!0,alwaysCheck:!1,alwaysDisplayState:!1,data:null,ignore:null,disabled:!1,cls:{valid:"",error:"",ajax:""},errorBox:{cls:"",fn:null,tag:"",position:"after",elem:null,enabled:!0},callback:{scope:null,destroy:null,statechange:null,errorchange:null,submit:null,check:null,beforeAjax:null,afterAjax:null,displaystate:null},rules:{},messages:{}},B=function(e){if(!e)return{};var a=
function(a,m,b){var c=e[a],d=!1;if(void 0!==c){switch(b){case "string":d=N(c);break;case "function":d=Q(c);break;case "boolean":d="boolean"==typeof c}d&&(e[a]={},e[a][m]=c)}};a("errorBox","enabled","boolean");a("errorBox","tag","string");a("errorBox","fn","function");return e},x=function(e,a,f){a=a||{};var b,c;this._observable=new I;h(this,this._observable.getApi());this.cfg=b=h({},A,B(n.fieldDefaults),B(a),!0,!0);this.input=new fa(e,this.onInputChange,this,this.onInputSubmit);this.elem=e;this.vldr=
f;this.callbackScope=c=b.callback.scope;this.enabled=!e.disabled;this.id=e.getAttribute("name")||e.getAttribute.attr("id");this.data=a.data;this.rules={};b.messages=h({},k,n.messages,b.messages,!0,!0);e.setAttribute("data-validator",f.getVldId());this.input.radio&&this.initRadio();for(var d in b.callback)if(b.callback[d])this.on(d,b.callback[d],c);b.rules&&this.setRules(b.rules,!1);this.readRules();this.prev=this.input.getValue();b.disabled&&this.disable()};x.prototype={vldr:null,elem:null,rules:null,
cfg:null,callbackScope:null,input:null,enabled:!0,valid:null,dirty:!1,id:null,prev:"",error:null,errorRule:null,pending:null,rulesNum:0,displayState:!1,data:null,checking:!1,checkTmt:null,errorBox:null,customError:!1,getValidator:function(){return this.vldr},initRadio:function(){var e=this.input.radio,a=this.vldr.getVldId(),f,b;f=0;for(b=e.length;f<b;f++)e[f].setAttribute("data-validator",a)},setRules:function(e,a){a=void 0==a?!0:a;for(var f in e)this.setRule(f,e[f],!1);a?this.check(!1):this.setValidState(null);
return this},setRule:function(a,m,f){var b=this.rules;f=void 0==f?!0:f;null===m?(b[a]&&this.rulesNum--,delete b[a]):(b[a]||this.rulesNum++,b[a]=m,null!==this.valid&&this.setValidState(!1));f?this.check(!1):this.setValidState(null);return this},setMessage:function(a,m){this.cfg.messages[a]=m;return this},setMessages:function(a){for(var m in a)this.setMessage(m,a[m]);return this},getMessages:function(){return h({},this.cfg.messages)},readRules:function(){var a=this.elem,m=a.className,f={},b,c;for(c in t)t.hasOwnProperty(c)&&
(b=a.getAttribute(c)||a.getAttribute("data-validate-"+c),null!==b&&void 0!=b&&!1!==b&&("minlength"!=c&&"maxlength"!=c||-1!=parseInt(b,10))&&(f[c]=b,(b=a.getAttribute("data-message-"+c))&&this.setMessage(c,b)));if(b=a.getAttribute("remote"))f.remote=b;if(m)for(m=m.split(" "),c=0,b=m.length;c<b;c++)if(a=O(m[c]),t[a]||"remote"==a)f[a]=!0;for(c in f)this.setRule(c,f[c],!1)},getRules:function(){return this.rules},hasRule:function(a){return this.rules[a]?!0:!1},getValue:function(){return this.input.getValue()},
getUserData:function(){return this.data},setUserData:function(a){var b=this.data;this.data=a;return b},isEmpty:function(){return d(this.getValue(),this.elem)},enable:function(){this.enabled=!0;this.vldr.reset();return this},disable:function(){this.enabled=!1;!1===this.valid&&(this.setValidState(!0),this.doDisplayState());return this},enableDisplayState:function(){this.displayState=!0},disableDisplayState:function(){this.displayState=!1},isDisplayStateEnabled:function(){return this.displayState},toggleErrorBox:function(a){var b=
this.cfg,f=b.errorBox.enabled;b.errorBox.enabled=a;!f&&a&&a.displayState&&!1===this.valid()&&this.doDisplayState()},isEnabled:function(){return this.enabled},getElem:function(){return this.elem},getName:function(){return this.id},getError:function(){return this.error},getErrorRule:function(){return this.errorRule},isValid:function(){return this.isEnabled()?this.customError?!1:!0===this.valid&&!this.pending||0===this.rulesNum:!0},getExactValidState:function(){return this.valid},setCustomError:function(a,
b){this.customError=a?!0:!1;this.setValidState(a?!1:!0);this.setError(!0===a?null:a,b);this.doDisplayState()},reset:function(){this.abort();this.dirty=!1;this.prev="";this.setValidState(null);this.setError(null);this.doDisplayState();return this},abort:function(){this.pending&&(this.pending.abort(),this.pending=null);return this},check:function(a){var b=this.rules,f=this.cfg,c=this.elem;if(!this.isEnabled())return!0;if(this.customError)return!1;if(0==this.rulesNum&&!1!==this.valid)return!0;if(this.checking)return this.checkTmt||
(this.checkTmt=setTimeout(D(this.checkTimeout,this),100)),!0===this.valid;this.checking=!0;if(!(!0===a||b.equalTo||b.notEqualTo||this.dirty||null===this.valid||f.alwaysCheck))return this.pending||this.doDisplayState(),this.checking=!1,!0===this.valid;var d=!0,h=!1,k=this.getValue(),n,l;for(l in b)if("remote"==l){if(this.dirty||f.alwaysCheck||null===this.valid||!0===a)if(k||b[l].checkEmpty)h=!0}else if(!0!==(n=(Q(b[l])?b[l]:t[l]).call(this.callbackScope,k,c,b[l],this))){d=!1;this.setError(g(n||f.messages[l]||
"",b[l]),l);break}h=h&&d;d&&this.setError(null);h?this.ajaxCheck():(this.setValidState(d),this.doDisplayState());this.checking=this.dirty=!1;this.trigger("check",this,this.valid);return!0===this.valid&&!h},doDisplayState:function(){var a=this.cfg,b=this.isValid(),f=a.cls.error,c=a.cls.valid,d=this.elem;this.displayState||a.alwaysDisplayState||(b=null);null===this.valid&&(b=null);f&&(!1===b?K(d,f):F(d,f));c&&(!0===b?K(d,c):F(d,c));f=this.getErrorBox();c=this.error;f&&(!1===b&&c&&(f.innerHTML=state.error),
f.style.display=!1===b&&c&&a.errorBox.enabled?"block":"none");this.trigger("displaystate",this,b,this.error)},getErrorBox:function(){var a=this.cfg.errorBox;return a.tag||a.fn||a.selector?(!this.errorBox&&a.enabled&&this.createErrorBox(),this.errorBox):null},destroy:function(){this.trigger("destroy",this);this.elem.removeAttribute("data-validator");this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);this.input.destroy();delete this.input;this._observable.destroy();delete this._observable;
delete this.vldr;delete this.cfg;delete this.errorBox;delete this.rules;delete this.elem},isPending:function(){return null!==this.pending},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},setError:function(a,b){if(this.error!=a||this.errorRule!=b)this.error=a,this.errorRule=b,this.trigger("errorchange",this,a,b)},checkTimeout:function(){this.checkTmt=null;this.checking||this.check(!1)},onInputChange:function(a){this.prev!==a&&(this.dirty=!0,this.customError=
!1,this.abort(),this.pending||this.check(!1),this.prev=this.input.getValue())},onInputSubmit:function(a){a=new H(a);if(!(a.isDefaultPrevented&&a.isDefaultPrevented()||!1!==this.trigger("submit",this,a)))return a.preventDefault(),!1},createErrorBox:function(){var a=this.cfg.errorBox,b=a.tag,f=a.cls,c=a.fn,d=a.position,a=a.elem;c?this.errorBox=c.call(this.callbackScope,this):a?this.errorBox=a:(this.errorBox=document.createElement(b),this.errorBox.className=f,b=(b=this.input.radio)?b[b-1]:this.elem,
"appendParent"==d?b.parentNode.appendChild(this.errorBox):"before"==d?b.parentNode.insertBefore(this.errorBox,b):b.parentNode.insertBefore(this.errorBox,b.nextSibling))},ajaxCheck:function(){var a=this.elem,b=this.rules.remote,f=this.getValue(),c=this.cfg,b=h({},N(b)?{url:b}:b,!0);b.data=b.data||{};b.data[b.paramName||a.getAttribute("name")||a.getAttribute("id")]=f;b.handler||(b.dataType="text");b.cache=!1;c.cls.ajax&&K(a,c.cls.ajax);this.trigger("beforeAjax",this,b);this.pending=(window.MetaphorJs?
M.ajax:jQuery.ajax)(b);this.pending.done(D(this.onAjaxSuccess,this));this.pending.fail(D(this.onAjaxError,this))},onAjaxSuccess:function(a){var b=this.rules,f=this.cfg;this.pending=null;var c=!0;b.remote.handler?(a=b.remote.handler.call(this.callbackScope,this,a),!0!==a&&(this.setError(g(a||f.messages.remote||"",b.remote),"remote"),c=!1)):a?(this.setError(a,"remote"),c=!1):this.setError(null);f.cls.ajax&&F(this.elem,f.cls.ajax);this.setValidState(c);this.doDisplayState();this.trigger("afterAjax",
this)},onAjaxError:function(a,b){var f=this.cfg;f.cls.ajax&&F(this.elem,f.cls.ajax);this.pending=null;"abort"!=b&&"abort"!=a&&(this.setValidState(!1),this.doDisplayState(),this.trigger("afterAjax",this))}};var J={alwaysCheck:!1,alwaysDisplayState:!1,disabled:!1,value:null,elem:null,errorBox:null,errorField:null,data:null,cls:{valid:"",error:""},fields:[],rules:{},messages:{},callback:{scope:null,destroy:null,statechange:null,errorchange:null,displaystate:null}},W=function(a,b){a=a||{};var f,c;this._observable=
new I;this._vldr=b;h(this,this._observable.getApi());this.cfg=f=h({},J,n.groupDefaults,a,!0,!0);this.callbackScope=c=f.callback.scope;this.data=a.data;this.el=a.elem;this.fields={};this.rules={};f.messages=h({},k,n.messages,f.messages,!0,!0);var d;if(f.callback)for(d in f.callback)if(f.callback[d])this.on(d,f.callback[d],c);f.rules&&this.setRules(f.rules,!1);if(f.fields)for(d=0,c=a.fields.length;d<c;d++)this.add(b.getField(f.fields[d]));this.enabled=!f.disabled};W.prototype={fields:null,rules:null,
cfg:null,callbackScope:null,vldr:null,enabled:!1,invalid:null,valid:null,displayState:!1,rulesNum:0,error:null,data:null,errorBox:null,el:null,enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},isValid:function(){return!this.enabled||0===this.invalid&&!0===this.valid},getExactValidState:function(){return this.valid},reset:function(){this.invalid=0;this.setValidState(null);this.setError(null);this.doDisplayState();
return this},getUserData:function(){return this.data},getName:function(){return this.cfg.name},setRules:function(a,b){b=void 0==b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check():this.setValidState(null);return this},setRule:function(a,b,c){var d=this.rules;c=void 0==c?!0:c;null===b?(d[a]&&this.rulesNum--,delete d[a]):(d[a]||this.rulesNum++,d[a]=b,null!==this.valid&&this.setValidState(!1));c?this.check():this.setValidState(null);return this},getRules:function(){return h({},this.rules)},
hasRule:function(a){return this.rules[a]?!0:!1},setError:function(a){var b=this.cfg;this.error!=a&&(b.errorField?(this.vldr.getField(b.errorField).setError(a),this.error=null):(this.error=a,this.trigger("errorchange",this,a)))},getError:function(){return this.error},getFields:function(){return this.fields},enableDisplayState:function(){this.displayState=!0;return this},disableDisplayState:function(){this.displayState=!1;return this},check:function(){var a=this.cfg,b=this.fields,c=this.rules;if(!this.enabled||
0==this.rulesNum)return this.setValidState(null),this.doDisplayState(),!0;this.countInvalid();if(0<this.invalid)return this.setValidState(null),this.doDisplayState(),!0;var d={},h=!0,k=null,n;if(a.value){for(n in b)d[n]=b[n].getValue();k=a.value.call(this.callbackScope,d,this)}for(n in c)if(!0!==(b=(Q(c[n])?c[n]:t[n]).call(this.callbackScope,k,null,c[n],this,d))){h=!1;b||a.messages[n]?this.setError(g(b||a.messages[n]||"",c[n])):this.setError(null);break}h&&this.setError(null);this.setValidState(h);
this.doDisplayState();return!0===this.valid},doDisplayState:function(){var a=this.valid,b=this.cfg;this.displayState||b.alwaysDisplayState||(a=null);if(b.errorBox){var c=this.getErrorBox();null!==a?c&&(c.innerHTML=this.error||"",c.style.display=!1===this.valid?"block":"none"):c&&(c.style.display="none")}c=b.cls.error;b=b.cls.valid;a=this.valid;c&&(!1===a?K(this.el,c):F(this.el,c));b&&(!0===a?K(this.el,b):F(this.el,b));this.trigger("displaystate",this,this.valid)},getErrorBox:function(){var a=this.cfg,
b=this.fields,c=a.errorBox;if(b[c])return b[c].getErrorBox();this.errorBox||(Q(a.errorBox)?this.errorBox=a.errorBox.call(this.callbackScope,this):this.errorBox=a.errorBox);return this.errorBox},destroy:function(){var a=this.fields,b;for(b in a)a[b]&&(this.setFieldEvents(a[b],"un"),delete a[b]);this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);this._observable.destroy();delete this._observable;delete this.vldr;delete this.rules;delete this.fields;delete this.cfg},add:function(a){var b=
this.fields,c=a.getName();b[c]||(b[c]=a,this.setFieldEvents(a,"on"))},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this)},remove:function(a){var b=this.fields,c=a.getName();b[c]&&(delete b[c],this.setFieldEvents(a,"un"));return this},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},countInvalid:function(){var a=this.fields;this.invalid=0;for(var b in a)this.invalid+=a[b].isValid()?0:1},onFieldStateChange:function(a,b){this.trigger("fieldstatechange",
this,a,b);this.check()}};var X={form:null,all:{},fields:{},rules:{},cls:{valid:"",error:"",checking:""},groups:{},callback:{scope:null,destroy:null,reset:null,beforesubmit:null,submit:null,statechange:null,check:null,displaystate:null,displaystatechange:null}},n=function(e,c,f){var d=e.nodeName.toLowerCase();this.vldId=++a;b[this.vldId]=this;e.setAttribute("data-validator",this.vldId);this.el=e;c&&!N(c)&&(f=c,c=null);this._observable=new I;this.cfg=e=h({},X,n.defaults,n[c],f,!0,!0);this.callbackScope=
c=e.callback.scope;this.isForm="form"==d;this.isField=/input|select|textarea/.test(d);this.fields={};this.groups={};h(this,this._observable.getApi());this.onRealSubmitClickDelegate=D(this.onRealSubmitClick,this);this.resetDelegate=D(this.reset,this);this.onSubmitClickDelegate=D(this.onSubmitClick,this);this.onFormSubmitDelegate=D(this.onFormSubmit,this);delete e.callback.scope;var g,k;for(k in e.callback)this.on(k,e.callback[k],c);this.initFields();d=this.fields;for(g in e.rules)d[g]&&d[g].setRules(e.rules[g],
!1);e.rules=null;for(g in e.groups)this.addGroup(g,e.groups[g]);this.initForm("bind");delete e.rules;delete e.fields;delete e.groups;this.enabled=!0};n.prototype={vldId:null,el:null,cfg:null,enabled:!1,invalid:null,pending:0,grps:0,outside:!0,submitted:!1,displayState:!1,isForm:!1,isField:!1,submitButton:null,hidden:null,callbackScope:null,_observable:null,fields:null,groups:null,getVldId:function(){return this.vldId},getElem:function(){return this.el},getGroup:function(a){return this.groups[a]||
null},getField:function(a){return this.fields[a]||null},enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},enableDisplayState:function(){var a=this.fields,b=this.groups,c;if(!0!==this.displayState){this.displayState=!0;for(c in a)a[c].enableDisplayState();for(c in b)b[c].enableDisplayState();this.trigger("displaystatechange",this,!0)}return this},disableDisplayState:function(){var a=this.groups,b=this.fields,c;if(!1!==
this.displayState){this.displayState=!1;for(c in b)b[c].disableDisplayState();for(c in a)a[c].disableDisplayState();this.trigger("displaystatechange",this,!1)}return this},isDisplayStateEnabled:function(){return this.displayState},isValid:function(){return!1===this.enabled?!0:0===this.invalid&&0===this.pending&&0===this.grps&&!0===this.outside},getErrors:function(a){var b=!0==a?[]:{},c,d,g,h=[this.fields,this.groups],k;if(!this.isEnabled())return b;for(g=0;2>g;g++)for(d in k=h[g],k)null===k[d].getExactValidState()&&
k[d].check(),k[d].isValid()||(c=k[d].getError())&&(a?b.push(c):b[d]=c);return b},check:function(){var a=this.fields,b=this.groups;if(!this.isEnabled())return!0;var c=this.isValid(),d;for(d in a)a[d].check();for(d in b)b[d].check();this.outside=!1!==this.trigger("check",this);a=this.isValid();c!=a&&(this.doDisplayState(),this.trigger("statechange",this,!1));return a},add:function(a,b){var c=a.nodeName.toLowerCase(),d=a.type;if("input"!=c&&"textarea"!=c&&"select"!=c||"submit"==d||"reset"==d||"button"==
d||null!==a.getAttribute("data-no-validate")||null!==a.getAttribute("data-validator"))return this;var d=a.getAttribute("name")||a.getAttribute("id"),g=this.cfg,c=this.fields;if(!d)return this;d=g.fields&&g.fields[d]?g.fields[d]:b||{};N(d)&&(d={rules:[d]});d=h({},g.all||{},d,!0,!0);if(d.ignore)return this;d.callback||(d.callback={scope:this.callbackScope});g=new x(a,d,this);d=g.getName();if(c[d])return this;c[d]=g;this.setFieldEvents(g,"on");this.displayState&&g.enableDisplayState();this.isEnabled()&&
null!==this.invalid&&g.check();return this},addGroup:function(a,b){var c=this.groups;c[a]||(b.name=a,c[a]=new W(b,this),this.setGroupEvents(c[a],"on"),this.isEnabled()&&null!==this.invalid&&c[a].check())},focusInvalid:function(){var a=this.fields,b;for(b in a)if(!a[b].isValid()){a[b].getElem().focus();break}},reset:function(){var a=this.fields,b=this.groups,c;this.submitted=!1;this.disableDisplayState();for(c in b)b[c].reset();for(c in a)a[c].reset();this.pending=0;this.invalid=null;this.grps=0;this.outside=
!1;this.doDisplayState();this.trigger("reset",this);return this},submit:function(){var a=this.el;if(this.isForm)if(Q(a.submit))!1!==this.trigger("beforesubmit",this)&&!1!==this.trigger("submit",this)&&a.submit();else this.onSubmit();else this.onSubmit()},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this);a[b]("beforeAjax",this.onBeforeAjax,this);a[b]("afterAjax",this.onAfterAjax,this);a[b]("submit",this.onFieldSubmit,this);a[b]("destroy",this.onFieldDestroy,this)},setGroupEvents:function(a,
b){a[b]("statechange",this.onGroupStateChange,this)},initFields:function(){var a=this.el,b,c;if(this.isField)return this.add(a),this;a=ca("input, textarea, select",a);b=-1;for(c=a.length;++b<c;this.add(a[b]));return this},initForm:function(a){var b=this.el,c=b.getElementsByTagName("input"),d=ca(".submit",b),g=ca(".reset",b);a="bind"==a?E:ba;var h,k,n,l;h=0;for(k=c.length;h<k;h++)l=c[h],n=l.type,"submit"==n?a(l,"click",this.onRealSubmitClickDelegate):"reset"==n&&a(l,"click",this.resetDelegate);h=-1;
for(k=d.length;++h<k;"submit"!=d[h].type&&a(d[h],"click",this.onSubmitClickDelegate));h=-1;for(k=g.length;++h<k;"reset"!=g[h].type&&a(g[h],"click",this.resetDelegate));this.isForm&&a(b,"submit",this.onFormSubmitDelegate)},onRealSubmitClick:function(a){a=new H(a||window.event);this.submitButton=a.target||a.srcElement;return this.onSubmit(a)},onSubmitClick:function(a){return this.onSubmit(new H(a||window.event))},onFormSubmit:function(a){a=new H(a);if(!this.isValid())return a.preventDefault(),!1},onFieldSubmit:function(a,
b){this.enableDisplayState();this.submitted=!0;return this.onSubmit(b)},onSubmit:function(a){this.enableDisplayState();if(this.pending)return a&&a.preventDefault(),!1;var b=this.submitButton?!0:!1;this.isForm&&(this.hidden&&(this.el.removeChild(this.hidden),this.hidden=null),this.submitButton&&/input|button/.test(this.submitButton.nodeName)&&(this.hidden=document.createElement("input"),this.hidden.type="hidden",this.hidden.setAttribute("name",this.submitButton.name),this.hidden.value=this.submitButton.value,
this.el.appendChild(this.hidden)));this.submitButton=null;if(!this.isValid()&&(this.check(),this.onFieldStateChange(),this.pending))return a&&a.preventDefault(),!1;if(!1===this.trigger("beforesubmit",this)||!this.isValid())return a&&(a.preventDefault(),a.stopPropagation()),this.pending||(this.focusInvalid(),this.submitted=!1),this.trigger("failedsubmit",this,b),!1;this.pending||(this.submitted=!1);return!1!==this.trigger("submit",this)},onFieldDestroy:function(a){a=a.getElem();a=a.getAttribute("name")||
a.getAttribute("id");delete this.fields[a]},onFieldStateChange:function(a,b){var c=this.invalid,d=this.fields;this.invalid=0;for(var g in d)this.invalid+=d[g].isValid()?0:1;a&&this.trigger("fieldstatechange",this,a,b);if(null===c||null!==c&&this.invalid!==c)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},onGroupStateChange:function(){var a=this.groups,b=this.grps;this.grps=0;for(var c in a)this.grps+=a[c].isValid()?0:1;if(null===b||null!==b&&this.grps!==b)this.doDisplayState(),
this.trigger("statechange",this,this.isValid())},doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,a=a.cls.valid,d=this.el;if(this.isField||!this.displayState)b=null;null===this.invalid&&(b=null);c&&(!1===b?K(d,c):F(d,c));a&&(!0===b?K(d,a):F(d,a));this.trigger("displaystate",this,b)},onBeforeAjax:function(){this.pending++;this.cfg.cls.ajax&&K(this.el,this.cfg.cls.ajax)},onAfterAjax:function(){var a=this.fields,b=this.cfg;this.pending=0;for(var c in a)this.pending+=a[c].isPending()?
1:0;this.doDisplayState();b.cls.ajax&&F(this.el,b.cls.ajax);this.submitted&&0==this.pending&&(this.submitted=!1,this.isValid()?this.submit():this.focusInvalid())},destroy:function(){var a=this.groups,c=this.fields,d;this.reset();this.trigger("destroy",this);delete b[this.vldId];for(d in a)a.hasOwnProperty(d)&&a[d]&&(this.setGroupEvents(a[d],"un"),a[d].destroy(),delete a[d]);for(d in c)c.hasOwnProperty(d)&&c[d]&&(this.setFieldEvents(c[d],"un"),c[d].destroy(),delete c[d]);this._observable.destroy();
delete this._observable;this.initForm("unbind");delete this.fields;delete this.groups;delete this.el;delete this.cfg}};n.defaults={};n.messages={};n.fieldDefaults={};n.groupDefaults={};n.addMethod=function(a,b,c){t[a]||(t[a]=b,c&&(n.messages[a]=c))};n.getValidator=function(a){a=a.getAttribute("data-validator");return b[a]||null};return n}();M.lib.Validator=ra;"undefined"!=typeof global?global.MetaphorJs=M:window.MetaphorJs=M})();
